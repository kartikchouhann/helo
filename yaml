  - stage: Prod_Manual_Rollback
    displayName: 'Manual Rollback Production'
    dependsOn: CD_TO_PROD
    condition: and(always(), eq(variables['Build.Reason'], 'Manual'))
    jobs:

      - job: Rollback
        displayName: 'Rollback Job'
        pool: server
        steps:
          - task: ManualValidation@0
            timeoutInMinutes: '60'
            inputs: 
              notifyUsers: |
                Prajeeth.Babu@cfins.com
                praful.mhatre@cfins.com
                venkatanihal.komarashetty@cfins.com
              instructions: 'Do you want to manually rollback to the previous version?'
              onTimeout: 'reject'
            displayName: 'Manual Approval for Rollback'    
      - deployment: PROD_ROLLBACK
        displayName: 'Trigger Manual Rollback'
        dependsOn: Rollback
        condition: succeeded()
        environment:
          name: PROD
          resourceName: AZR-P-ROSSWB-VM         
          resourceType: VirtualMachine
        strategy:
          runOnce:
            deploy:
              steps:             
                - task: CmdLine@2
                  inputs:
                    script: |
                      dir C:\RossCodeBackup\ROSS
                  displayName: verify Backup Artifacts

                - task: PowerShell@2
                  inputs:
                    targetType: 'inline'
                    script: |
                      Stop-Service -Name 'w3svc'
                  displayName: 'Stopping IIS Service'

                - task: PowerShell@2
                  inputs:
                    targetType: 'inline'
                    script: |
                      Get-Service -Name 'w3svc'
                  displayName: 'Getting IIS Service Status'

                - task: PowerShell@2
                  inputs:
                    targetType: 'inline'
                    script: |
                      Copy-Item -Path "C:\RossCodeBackup\ROSS\app" -Destination "C:\Web\ROSS" -Recurse -Force
                  displayName: 'Deploying Webapp'

                - task: PowerShell@2
                  inputs:
                    targetType: 'inline'
                    script: |
                      Copy-Item -Path "C:\RossCodeBackup\ROSS\accountingAdminService" -Destination "C:\Web\ROSS" -Recurse -Force
                  displayName: 'Deploying accountingAndReportingService'

                - task: PowerShell@2
                  inputs:
                    targetType: 'inline'
                    script: |
                      Copy-Item -Path "C:\RossCodeBackup\ROSS\actuarialService" -Destination "C:\Web\ROSS" -Recurse -Force
                  displayName: 'Deploying actuarialService'

                - task: PowerShell@2
                  inputs:
                    targetType: 'inline'
                    script: |
                      Copy-Item -Path "C:\RossCodeBackup\ROSS\adminService" -Destination "C:\Web\ROSS" -Recurse -Force
                  displayName: 'Deploying adminService'

                - task: PowerShell@2
                  inputs:
                    targetType: 'inline'
                    script: |
                      Copy-Item -Path "C:\RossCodeBackup\ROSS\premiumAuditService" -Destination "C:\Web\ROSS" -Recurse -Force
                  displayName: 'Deploying auditPremiumService'

                - task: PowerShell@2
                  inputs:
                    targetType: 'inline'
                    script: |
                      Copy-Item -Path "C:\RossCodeBackup\ROSS\claimsAuditService" -Destination "C:\Web\ROSS" -Recurse -Force
                  displayName: 'Deploying claimsAuditService'

                - task: PowerShell@2
                  inputs:
                    targetType: 'inline'
                    script: |
                      Copy-Item -Path "C:\RossCodeBackup\ROSS\litigationService" -Destination "C:\Web\ROSS" -Recurse -Force
                  displayName: 'Deploying litigationService'

                - task: PowerShell@2
                  inputs:
                    targetType: 'inline'
                    script: |
                      Copy-Item -Path "C:\RossCodeBackup\ROSS\underwritingService" -Destination "C:\Web\ROSS" -Recurse -Force
                  displayName: 'Deploying underWritingService'

                - task: PowerShell@2
                  inputs:
                    targetType: 'inline'
                    script: |
                      Start-Service -Name 'w3svc'
                  displayName: 'Starting IIS Service'

                - task: PowerShell@2
                  inputs:
                    targetType: 'inline'
                    script: |
                      Get-Service -Name 'w3svc'
                  displayName: 'Getting IIS Service Status'
