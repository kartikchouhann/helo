# Define the source directory
$source = "C:\Users\HP\Desktop\WALGREENS"

# Define the base destination directory
$baseDestination = "C:\Users\HP\Desktop\todAY"

# Get the current date in yyyy-MM-dd format for the folder name
$currentDate = Get-Date -Format "yyyy-MM-dd"

# Define the destination directory with the current date
$destination = Join-Path -Path $baseDestination -ChildPath $currentDate

# Ensure the dated backup folder exists
if (-not (Test-Path -Path $destination)) {
    New-Item -ItemType Directory -Path $destination -Force
    Write-Host "Created backup folder: $destination"
}

# Get all files and folders in the source directory, excluding 'log'
Get-ChildItem -Path $source -Recurse -Exclude "log" | ForEach-Object {
    # Generate the corresponding target path in the dated backup folder
    $targetPath = $_.FullName.Replace($source, $destination)
    
    # Check if the current item is a folder
    if ($_.PsIsContainer) {
        # Create the folder in the destination
        if (-not (Test-Path -Path $targetPath)) {
            New-Item -ItemType Directory -Force -Path $targetPath
        }
    } else {
        # Copy the file to the destination
        Copy-Item -Path $_.FullName -Destination $targetPath -Force
    }
}

Write-Host "Backup completed. Files are saved in $destination."
