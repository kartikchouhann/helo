ok.  can you please test these changes in a lower env to make sure they work? (edited) 


I scoped the role using the AWS-recommended Elastic Beanstalk service-role policies instead of the broad admin policy.
This role is specifically used for Elastic Beanstalk deployments, while instance roles continue to handle any app-specific permissions.

GM Salma, how did you determine the appropriate permissions for this role and what is using this role?



"Resource": [
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/pulse/aws/accesskey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/pulse/aws/accesskeysecret/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/*/redis/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/*/mysql/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/*/mysql/readonly-connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/general/certificates/vas-com/password/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/email/username/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/email/password/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/partners/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/*/raygun/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/*/seq/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/slack/webhook/*/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/scotmoves/username/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/scotmoves/password/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/scotmoves/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/general/google-geocoding/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/sdk/storage/accesskey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/sdk/storage/secretkey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/pulse/aws/sdk/accesskey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/pulse/aws/sdk/accesskeysecret/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/genetics-etl/mysql/urus-connections-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/genetics/mysql/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/general/c2c/shared-secret/*"
]





{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowWriteLogs",
            "Action": [
                "logs:PutLogEvents",
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:DescribeLogGroups",
                "logs:DescribeLogStreams"
            ],
            "Effect": "Allow",
            "Resource": "arn:aws:logs:${region}:${account_id}:log-group:/aws/ecs/fargate/service/*"
        },
        {
            "Sid": "AllowECRActions",
            "Action": [
                "ecr:GetAuthorizationToken",
                "ecr:BatchGetImage",
                "ecr:GetDownloadUrlForLayer"
            ],
            "Effect": "Allow",
            "Resource": "*"
        },
        {
            "Sid": "AllowGetECRImages",
            "Action": [
                "ecr:DescribeRepositories",
                "ecr:DescribeImages",
                "ecr:ListImages",
                "ecr:GetRepositoryPolicy",
                "ecr:BatchCheckLayerAvailability"
            ],
            "Effect": "Allow",
            "Resource": ${ecr_repo_list}
        },
        {
            "Sid": "SecretManagerAccess",
            "Action": [
                "kms:Decrypt",
                "secretsmanager:GetSecretValue"
            ],
            "Effect": "Allow",
            "Resource": [ 
                "arn:aws:secretsmanager:${region}:${account_id}:secret:service/*",
                "arn:aws:kms:${region}:${account_id}:key/${kms_alias}"
            ]
        },
        {
            "Sid": "DenyDeleteAllBuckets",
            "Action": [
              "s3:DeleteBucket"
            ],
            "Effect": "Deny",
            "Resource": [
              "arn:aws:s3:::*"
            ]
        }
    ]
}


src\terraform\pulse\security\iam\role_policies\pulse-cluster-task-execution-role-policy.json























"Resource": [
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/pulse/aws/accesskey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/pulse/aws/accesskeysecret/*",

  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/alerts/redis/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/auth/redis/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/feed/redis/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/feednext/redis/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/genetics/redis/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/herd/redis/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/monolith/redis/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/onpremise-sync/redis/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/ops/redis/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/parlors/redis/connection-string/*",

  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/auth/mysql/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/parlors/mysql/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/ops/mysql/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/jobsrunner/mysql/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/feed/mysql/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/herd/mysql/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/genetics/mysql/connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/pulse/mysql/migrations/connection/*",

  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/auth/mysql/readonly-connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/feed/mysql/readonly-connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/herd/mysql/readonly-connection-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/genetics/mysql/readonly-connection-string/*",

  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/general/certificates/vas-com/password/*",

  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/email/username/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/email/password/*",

  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/partners/apikey/*",

  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/alerts/raygun/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/auth/raygun/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/feed/raygun/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/feednext/raygun/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/genetics/raygun/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/herd/raygun/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/monolith/raygun/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/onpremise-sync/raygun/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/ops/raygun/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/parlors/raygun/apikey/*",

  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/alerts/seq/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/auth/seq/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/feed/seq/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/feednext/seq/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/genetics/seq/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/herd/seq/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/monolith/seq/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/onpremise-sync/seq/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/ops/seq/apikey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/parlors/seq/apikey/*",

  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/slack/webhook/*",

  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/scotmoves/username/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/scotmoves/password/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/scotmoves/apikey/*",

  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/general/google-geocoding/apikey/*",

  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/sdk/storage/accesskey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/sdk/storage/secretkey/*",

  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/pulse/aws/sdk/accesskey/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/pulse/aws/sdk/accesskeysecret/*",

  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/genetics-etl/mysql/urus-connections-string/*",
  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/genetics/mysql/connection-string/*",

  "arn:aws:secretsmanager:${region}:${account_id}:secret:service/general/c2c/shared-secret/*"
]
