{
  "Version": "2012-10-17",
  "Statement": [
      {
        "Sid": "CloudwatchAccessForJR",
        "Action": [
          "logs:PutLogEvents",
          "logs:CreateLogStream",
          "logs:CreateLogGroup",
          "logs:DescribeLogGroups",
          "logs:DescribeLogStreams",
          "cloudwatch:PutMetricData"
        ],
        "Effect": "Allow",
        "Resource": "arn:aws:logs:${region}:${account_id}:log-group:/*"
      },
      {
        "Sid": "SecretsAccessForJR",
        "Action": ["secretsmanager:GetSecretValue"],
        "Effect": "Allow",
        "Resource": "arn:aws:secretsmanager:${region}:${account_id}:secret:*"
      },
      {
        "Sid": "KMSAccessForJR",
        "Action": [
         "kms:Decrypt",
         "kms:GenerateDataKey"
      ],
        "Effect": "Allow",
        "Resource": "arn:aws:kms:${region}:${account_id}:key/${kms_alias}"
      },
      {
        "Sid": "SQSAccessForJR",
        "Effect": "Allow",
        "Action": [
          "sqs:ChangeMessageVisibility",
          "sqs:ChangeMessageVisibilityBatch",
          "sqs:DeleteMessage",
          "sqs:DeleteMessageBatch",
          "sqs:GetQueueAttributes",
          "sqs:GetQueueUrl",
          "sqs:ListDeadLetterSourceQueues",
          "sqs:ListQueueTags",
          "sqs:ListQueues",
          "sqs:ReceiveMessage",
          "sqs:SendMessage",
          "sqs:SendMessageBatch",
          "sqs:SetQueueAttributes"
        ],
        "Resource": ["arn:aws:sqs:${region}:${account_id}:*"]
      },
      {
          "Sid": "DenyDeleteQueues",
          "Effect": "Deny",
          "Action": ["sqs:DeleteQueue"],
          "Resource": ["arn:aws:sqs:*:*:*"]
      },
      {
        "Sid": "SNSAccessForJR",
        "Effect": "Allow",
        "Action": [
          "sns:ListTopics",
          "sns:Publish"
        ],
        "Resource": ${sns_topics_list}
      },
      {
        "Sid": "DenyDeleteTopics",
        "Effect": "Deny",
        "Action": ["sns:DeleteTopic"],
        "Resource": ["arn:aws:sns:*"]
      },
      {
        "Sid": "S3BucketsAccessForJR",
        "Action": [
            "s3:PutObject",
            "s3:PutObjectAcl",
            "s3:ListBucket",
            "s3:GetObject",
            "s3:GetObjectAcl",
            "s3:DeleteObject"
        ],
        "Effect": "Allow",
        "Resource": ${buckets_names_mix}
      },
      {
          "Sid": "DenyDeleteBuckets",
          "Effect": "Deny",
          "Action": ["s3:DeleteBucket"],
          "Resource": ["arn:aws:s3:::*"]
      },
      {
        "Sid": "ParameterStoreAccessPut",
        "Effect": "Allow",
        "Action": [
          "ssm:PutParameter",
          "ssm:GetParametersByPath"
        ],
        "Resource": "arn:aws:ssm:${region}:${account_id}:parameter/service/carepackages/dataprotection/keys/*"
      },
      {
        "Sid": "AllowS3BucketActions",
        "Effect": "Allow",
        "Action": [
          "s3:GetObject",
          "s3:PutObject",
          "s3:DeleteObject",
          "s3:ListBucket"
        ],
        "Resource": ${jsonencode([for bucket_name in buckets_names : "arn:aws:s3:::${bucket_name}/*"])}
      }
  ]
}